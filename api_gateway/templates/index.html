<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Lan√ßamentos Financeiros</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            min-height: 600px;
        }

        .sidebar {
            width: 250px;
            background: #f8f9fa;
            padding: 30px 20px;
            border-right: 1px solid #e9ecef;
        }

        .nav-button {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .nav-button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .nav-button.active {
            background: #27ae60;
        }

        .content {
            flex: 1;
            padding: 30px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn-primary {
            background: #27ae60;
            color: white;
        }

        .btn-primary:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }

        .table tbody tr:hover {
            background: #f8f9fa;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            flex: 1;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí≥ Sistema de Lan√ßamentos Financeiros</h1>
            <p>Microservices com Flask - Gest√£o de Usu√°rios e Transa√ß√µes</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <button class="nav-button active" onclick="showSection('dashboard')">üìä Dashboard</button>
                <button class="nav-button" onclick="showSection('users')">üë• Usu√°rios</button>
                <button class="nav-button" onclick="showSection('transactions')">üí≥ Transa√ß√µes</button>
                <button class="nav-button" onclick="showSection('new-transaction')">‚ûï Nova Transa√ß√£o</button>
                <button class="nav-button" onclick="showSection('reports')">üìà Relat√≥rios</button>
            </div>

            <div class="content">
                <!-- Dashboard Section -->
                <div id="dashboard" class="section active">
                    <h2>üìä Dashboard</h2>
                    <div class="stats">
                        <div class="stat-card">
                            <h3 id="total-users">-</h3>
                            <p>Total de Usu√°rios</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="total-transactions">-</h3>
                            <p>Total de Transa√ß√µes</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="total-amount">-</h3>
                            <p>Valor Total</p>
                        </div>
                    </div>
                    <div class="card">
                        <h3>üè• Status dos Microservices</h3>
                        <div id="health-status">Carregando...</div>
                    </div>
                </div>

                <!-- Users Section -->
                <div id="users" class="section">
                    <h2>üë• Gest√£o de Usu√°rios</h2>
                    <div class="card">
                        <h3>Criar Novo Usu√°rio</h3>
                        <form id="user-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="user-name">Nome:</label>
                                    <input type="text" id="user-name" required>
                                </div>
                                <div class="form-group">
                                    <label for="user-email">Email:</label>
                                    <input type="email" id="user-email" required>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Criar Usu√°rio</button>
                        </form>
                    </div>
                    <div class="card">
                        <h3>Lista de Usu√°rios</h3>
                        <div id="users-list">Carregando...</div>
                    </div>
                </div>

                <!-- Transactions Section -->
                <div id="transactions" class="section">
                    <h2>üí≥ Lista de Transa√ß√µes</h2>
                    <div class="card">
                        <div id="transactions-list">Carregando...</div>
                    </div>
                </div>

                <!-- New Transaction Section -->
                <div id="new-transaction" class="section">
                    <h2>‚ûï Nova Transa√ß√£o</h2>
                    <div class="card">
                        <form id="transaction-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="transaction-user">Usu√°rio:</label>
                                    <select id="transaction-user" required>
                                        <option value="">Selecione um usu√°rio...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="transaction-amount">Valor (R$):</label>
                                    <input type="number" id="transaction-amount" step="0.01" min="0.01" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="transaction-description">Descri√ß√£o:</label>
                                <input type="text" id="transaction-description" required placeholder="Ex: Compra no supermercado">
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="transaction-card-type">Tipo de Cart√£o:</label>
                                    <select id="transaction-card-type" required>
                                        <option value="">Selecione o tipo...</option>
                                        <option value="Cr√©dito">Cr√©dito</option>
                                        <option value="D√©bito">D√©bito</option>
                                        <option value="Pr√©-pago">Pr√©-pago</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="transaction-card-final">√öltimos 4 d√≠gitos:</label>
                                    <input type="text" id="transaction-card-final" maxlength="4" pattern="[0-9]{4}" required placeholder="1234">
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">üíæ Salvar Transa√ß√£o</button>
                            <button type="button" class="btn btn-secondary" onclick="clearTransactionForm()">üîÑ Limpar</button>
                        </form>
                    </div>
                </div>

                <!-- Reports Section -->
                <div id="reports" class="section">
                    <h2>üìà Relat√≥rios</h2>
                    <div class="card">
                        <h3>Relat√≥rio por Usu√°rio</h3>
                        <div class="form-group">
                            <label for="report-user">Selecione o Usu√°rio:</label>
                            <select id="report-user">
                                <option value="">Selecione um usu√°rio...</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="generateReport()">Gerar Relat√≥rio</button>
                    </div>
                    <div id="report-content"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Base URL for API calls
        const API_BASE = 'http://localhost:5000/api';
        
        // Show/hide sections
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.nav-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Load data based on section
            if (sectionId === 'dashboard') {
                loadDashboard();
            } else if (sectionId === 'users') {
                loadUsers();
            } else if (sectionId === 'transactions') {
                loadTransactions();
            } else if (sectionId === 'new-transaction') {
                loadUsersForSelect();
            } else if (sectionId === 'reports') {
                loadUsersForReports();
            }
        }

        // Load dashboard data
        async function loadDashboard() {
            try {
                // Load health status
                const healthResponse = await fetch(`${API_BASE.replace('/api', '')}/health`);
                const health = await healthResponse.json();
                
                let healthHtml = '<table class="table"><tr><th>Servi√ßo</th><th>Status</th><th>URL</th></tr>';
                healthHtml += `<tr><td>Gateway</td><td>‚úÖ ${health.gateway_status}</td><td>http://localhost:5000</td></tr>`;
                
                for (const [service, info] of Object.entries(health.servicos)) {
                    const status = info.codigo === 200 ? '‚úÖ Ativo' : '‚ùå Inativo';
                    healthHtml += `<tr><td>${service}</td><td>${status}</td><td>${info.url}</td></tr>`;
                }
                healthHtml += '</table>';
                document.getElementById('health-status').innerHTML = healthHtml;

                // Load summary stats
                const usersResponse = await fetch(`${API_BASE}/users`);
                const users = await usersResponse.json();
                document.getElementById('total-users').textContent = users.length;

                const transactionsResponse = await fetch(`${API_BASE}/transactions`);
                const transactionsData = await transactionsResponse.json();
                document.getElementById('total-transactions').textContent = transactionsData.count || 0;
                
                const totalAmount = transactionsData.transacoes?.reduce((sum, t) => sum + t.valor, 0) || 0;
                document.getElementById('total-amount').textContent = `R$ ${totalAmount.toFixed(2)}`;
                
            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
            }
        }

        // Load users
        async function loadUsers() {
            try {
                const response = await fetch(`${API_BASE}/users`);
                const users = await response.json();
                
                let html = '<table class="table"><tr><th>ID</th><th>Nome</th><th>Email</th><th>Data Cria√ß√£o</th></tr>';
                users.forEach(user => {
                    const date = new Date(user.data_criacao).toLocaleDateString('pt-BR');
                    html += `<tr><td>${user.id}</td><td>${user.nome}</td><td>${user.email}</td><td>${date}</td></tr>`;
                });
                html += '</table>';
                
                document.getElementById('users-list').innerHTML = html;
            } catch (error) {
                document.getElementById('users-list').innerHTML = '<div class="alert alert-error">Erro ao carregar usu√°rios</div>';
            }
        }

        // Load transactions
        async function loadTransactions() {
            try {
                const response = await fetch(`${API_BASE}/transactions`);
                const data = await response.json();
                
                let html = '<table class="table"><tr><th>ID</th><th>Usu√°rio ID</th><th>Descri√ß√£o</th><th>Valor</th><th>Cart√£o</th><th>Data</th></tr>';
                data.transacoes.forEach(transaction => {
                    const date = new Date(transaction.data_lancamento).toLocaleDateString('pt-BR');
                    const valor = `R$ ${transaction.valor.toFixed(2)}`;
                    const cartao = `${transaction.cartao_tipo} ****${transaction.cartao_final}`;
                    html += `<tr><td>${transaction.id}</td><td>${transaction.usuario_id}</td><td>${transaction.descricao}</td><td>${valor}</td><td>${cartao}</td><td>${date}</td></tr>`;
                });
                html += '</table>';
                
                document.getElementById('transactions-list').innerHTML = html;
            } catch (error) {
                document.getElementById('transactions-list').innerHTML = '<div class="alert alert-error">Erro ao carregar transa√ß√µes</div>';
            }
        }

        // Load users for select dropdown
        async function loadUsersForSelect() {
            try {
                const response = await fetch(`${API_BASE}/users`);
                const users = await response.json();
                
                const select = document.getElementById('transaction-user');
                select.innerHTML = '<option value="">Selecione um usu√°rio...</option>';
                
                users.forEach(user => {
                    select.innerHTML += `<option value="${user.id}">${user.nome} (${user.email})</option>`;
                });
            } catch (error) {
                console.error('Erro ao carregar usu√°rios:', error);
            }
        }

        // Load users for reports
        async function loadUsersForReports() {
            try {
                const response = await fetch(`${API_BASE}/users`);
                const users = await response.json();
                
                const select = document.getElementById('report-user');
                select.innerHTML = '<option value="">Selecione um usu√°rio...</option>';
                
                users.forEach(user => {
                    select.innerHTML += `<option value="${user.id}">${user.nome} (${user.email})</option>`;
                });
            } catch (error) {
                console.error('Erro ao carregar usu√°rios:', error);
            }
        }

        // Form handlers
        document.getElementById('user-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const userData = {
                nome: document.getElementById('user-name').value,
                email: document.getElementById('user-email').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/users`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });
                
                if (response.ok) {
                    showAlert('Usu√°rio criado com sucesso!', 'success');
                    this.reset();
                    loadUsers();
                } else {
                    throw new Error('Erro ao criar usu√°rio');
                }
            } catch (error) {
                showAlert('Erro ao criar usu√°rio', 'error');
            }
        });

        document.getElementById('transaction-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const transactionData = {
                usuario_id: parseInt(document.getElementById('transaction-user').value),
                descricao: document.getElementById('transaction-description').value,
                valor: parseFloat(document.getElementById('transaction-amount').value),
                cartao_tipo: document.getElementById('transaction-card-type').value,
                cartao_final: document.getElementById('transaction-card-final').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/transactions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(transactionData)
                });
                
                if (response.ok) {
                    showAlert('Transa√ß√£o criada com sucesso!', 'success');
                    this.reset();
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.mensagem || 'Erro ao criar transa√ß√£o');
                }
            } catch (error) {
                showAlert(`Erro ao criar transa√ß√£o: ${error.message}`, 'error');
            }
        });

        // Clear transaction form
        function clearTransactionForm() {
            document.getElementById('transaction-form').reset();
        }

        // Generate report
        async function generateReport() {
            const userId = document.getElementById('report-user').value;
            if (!userId) {
                showAlert('Selecione um usu√°rio', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/reports/user/${userId}`);
                const report = await response.json();
                
                let html = '<div class="card">';
                html += `<h3>üìä Relat√≥rio - ${report.usuario.nome}</h3>`;
                html += `<p><strong>Email:</strong> ${report.usuario.email}</p>`;
                html += `<h4>üí∞ Resumo Financeiro</h4>`;
                html += `<p><strong>Total de Transa√ß√µes:</strong> ${report.resumo_financeiro.total_transacoes}</p>`;
                html += `<p><strong>Total Gasto:</strong> R$ ${report.resumo_financeiro.total_gasto.toFixed(2)}</p>`;
                
                if (report.transacoes.length > 0) {
                    html += '<h4>üìã √öltimas Transa√ß√µes</h4>';
                    html += '<table class="table"><tr><th>Descri√ß√£o</th><th>Valor</th><th>Cart√£o</th><th>Data</th></tr>';
                    report.transacoes.forEach(t => {
                        const date = new Date(t.data_lancamento).toLocaleDateString('pt-BR');
                        html += `<tr><td>${t.descricao}</td><td>R$ ${t.valor.toFixed(2)}</td><td>${t.cartao_tipo} ****${t.cartao_final}</td><td>${date}</td></tr>`;
                    });
                    html += '</table>';
                }
                html += '</div>';
                
                document.getElementById('report-content').innerHTML = html;
            } catch (error) {
                showAlert('Erro ao gerar relat√≥rio', 'error');
            }
        }

        // Show alert messages
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            // Insert at the beginning of the active section
            const activeSection = document.querySelector('.section.active');
            activeSection.insertBefore(alertDiv, activeSection.firstChild);
            
            // Remove after 5 seconds
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Initialize dashboard on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
        });
    </script>
</body>
</html>